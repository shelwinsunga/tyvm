import numpy as np

def sigmoid(x):
    return 1 / (1 + np.exp(-x))

# Sample data
# Input: (1 x 784) vector - represents one flattened MNIST image (28x28 pixels)
X = [0.3650744641604983, 0.41303962795366583, 0.498020630891858, 0.015013785908919042, 0.40655033224309867, 0.019300331823740892, 0.6426731845495632, 0.6020385144204666, 0.4629288050707742, 0.06635050481627078, 0.32056856784620047, 0.10167300181119993, 0.11848850631763509, 0.07842439808419188, 0.09205482729527495, 0.4558105143536148, 0.6915072519042456, 0.06457627953169535, 0.47122142949215506, 0.2845137710429651, 0.39257318266748853, 0.21939525551777983, 0.03890252185841247, 0.3968337257083702, 0.49473955819929255, 0.3358598741953938, 0.17471044876806582, 0.5564023749642145, 0.5746115704619799, 0.05144786409050783, 0.49872104681122864, 0.46944476710904315, 0.33486034376991264, 0.6665703595129117, 0.9207722663741457, 0.21852775605087696, 0.674304345702045, 0.13412977403430557, 0.6930596307714804, 0.1907213580482552, 0.6339471387304833, 0.3217345290878399, 0.3081303425451331, 0.05594971850758236, 0.04951352539747627, 0.15291974961848015, 0.2031265988164081, 0.1531792080714941, 0.21630820908911225, 0.25239390225463715, 0.9951407164196129, 0.9311564209410812, 0.7215829392829601, 0.165262839293984, 0.02463943532121242, 0.9855536847891743, 0.8789815143204716, 0.35969293205561037, 0.3529294997051489, 0.8551594793249897, 0.5052082732472037, 0.6135360416781988, 0.013392634181639761, 0.3844430245261135]

# Weights: (128 x 784) matrix - each row represents weights for one neuron
W = [[0.6850570577245203, 0.8414109865873953, 0.46149833884679914, 0.45175460901580294, 0.9397024251080166, 0.6941584696329633, 0.9519624197048415, 0.17166424401464547, 0.5123009385012113, 0.6278361120181105, 0.7946714251199791, 0.3053130907146311, 0.8405475088844042, 0.6136576736526137, 0.6079001141475655, 0.523401737294125, 0.8265876074380428, 0.37015396534124684, 0.884471559130929, 0.18737397625893512, 0.2277055110890614, 0.6357109104476362, 0.7025810651705078, 0.6649215653522754, 0.1949173897804895, 0.8884639996023442, 0.755992869792157, 0.7011179738285115, 0.4076513156873361, 0.593453820349177, 0.9784938167689511, 0.7825148338915521, 0.3943813629507879, 0.08786312884008934, 0.9985823486435925, 0.8952986671204267, 0.8731614432994073, 0.2301434895937869, 0.19766982896009358, 0.8897044560498425, 0.9428366067737294, 0.4762898869437655, 0.13405402069191874, 0.7290875194202975, 0.16230243629106483, 0.2970609266087465, 0.5924686172117175, 0.7608755114716307, 0.23314040571582273, 0.11908145019775818, 0.05864446359390658, 0.2268512236083141, 0.1324542027839915, 0.08343952829357835, 0.9929686424717392, 0.7842979296149134, 0.5142312299561939, 0.9087516087820409, 0.6128721366023377, 0.7056654316612401, 0.7381167266071224, 0.5431181563767198, 0.19863141508677873, 0.47702779564402265], [0.7695018415442425, 0.3957222635246746, 0.1427290879433815, 0.2541320774899075, 0.9703164053147235, 0.31203812053494534, 0.9141788354206454, 0.5641427903804296, 0.8972002964557733, 0.013070133985291815, 0.18804090054546782, 0.9803592629509076, 0.07873138348393559, 0.914835733712537, 0.1643680571120451, 0.8771710920930147, 0.22298614328253458, 0.1063159412257774, 0.9717134357573156, 0.3852340632555864, 0.992740620136245, 0.6765464156873251, 0.654161750577397, 0.327033088709137, 0.9962673990674875, 0.7501128353099097, 0.7610981909452132, 0.44628486141293106, 0.457178028763748, 0.11593011609865737, 0.8054232617480207, 0.2982608571716014, 0.4469605271538252, 0.007413676805891991, 0.4431408218374012, 0.3979851919780293, 0.05098156282235677, 0.47677072651311775, 0.9818877159557905, 0.7662990065105606, 0.9649954414569744, 0.27405647840656305, 0.23433994043945494, 0.8046082426077095, 0.34321826747660705, 0.4452482722697408, 0.09181937995543152, 0.5423042067296454, 0.21918316342114777, 0.6592167109462302, 0.6631422793393376, 0.23704180546084638, 0.9042721954847449, 0.9291284503037409, 0.5318177476068688, 0.9910135702232019, 0.16190737699355787, 0.39358260644946674, 0.10025041667009364, 0.03881254268065443, 0.1431138351506255, 0.023879306612366143, 0.53678437600997, 0.4144830246416441], [0.7231273965098354, 0.6472234539055496, 0.2703979534271993, 0.634206324782111, 0.5853840855023154, 0.6857809590237643, 0.5156887601346234, 0.8257826580539916, 0.9252596914910688, 0.6045717945329345, 0.19926903382755923, 0.2208791923242976, 0.5645266177943461, 0.4157972661613431, 0.506039662119607, 0.3564155494628828, 0.25746139036783816, 0.4983604511487708, 0.9201964116691684, 0.4590290161211885, 0.07265746225649448, 0.4400986162596018, 0.29845835453282776, 0.6164370309780243, 0.7706715256435472, 0.5728343852322281, 0.5937780909824867, 0.4941526744155015, 0.22972124986117717, 0.9109477944597926, 0.31013268162667734, 0.8113761188246821, 0.24441712660875495, 0.8567837148037721, 0.16511215655034106, 0.5372849067350356, 0.23511560381569024, 0.7484149850390847, 0.06240111950381327, 0.8232828416076737, 0.06695686519257116, 0.32909749975392966, 0.1419629753959352, 0.19208520022998327, 0.09256203888535591, 0.9016214712577963, 0.9114856406130504, 0.8722644399892174, 0.550885087029821, 0.8092560312882195, 0.715162163952581, 0.7765241461609451, 0.07029911873750713, 0.06656003776702551, 0.8546606442804456, 0.7266741185737423, 0.5306907286115529, 0.7178150196059044, 0.06160583491603112, 0.32053490338230695, 0.06163779902221967, 0.44340796126657717, 0.9691453891800238, 0.2634021071730031], [0.2617468573491385, 0.9547798460298973, 0.5219171808367576, 0.6119610879762308, 0.5383413685695659, 0.8561797306251384, 0.29680227241577684, 0.22349259767420757, 0.3255879961992014, 0.8593177050866047, 0.40201518131988095, 0.22898074841184604, 0.3166829054515005, 0.26244056815351746, 0.015460610665123052, 0.03156278026050042, 0.46919609899361914, 0.45670943984944057, 0.2878193917604825, 0.04956388953591419, 0.7301633952928832, 0.3995208830277176, 0.20986953372903283, 0.9522879311979415, 0.7866272419679391, 0.6844499289698728, 0.9429795953444103, 0.9188090819360334, 0.6209491139159277, 0.9863729400253433, 0.6059769376457429, 0.5242938923638716, 0.14215744732416588, 0.10898367734652889, 0.616607113034738, 0.3710027250578704, 0.1646198744727483, 0.44716898663708327, 0.356642671318875, 0.13753799399156538, 0.9976332475848676, 0.6368538130667294, 0.4847094745875588, 0.6250005680474608, 0.43985381649932676, 0.30064681064081145, 0.6455164786175211, 0.12935374266077632, 0.6785260608844174, 0.6513971065452515, 0.5296242702938175, 0.17531631279644513, 0.6480542186851045, 0.5388153027360518, 0.3825717328089511, 0.26843993668716243, 0.9177755692637786, 0.0026647356995962964, 0.6459857599839839, 0.6903723879293476, 0.8919588663125384, 0.18507404852363335, 0.5549634371511148, 0.6749151391700966], [0.5631328226198582, 0.5418731543199443, 0.9975343510639821, 0.6078829172340671, 0.16467509519107884, 0.9925539704411129, 0.5499917935783355, 0.10157374792398498, 0.46767374639240417, 0.07191614971551143, 0.6083796226379425, 0.8960065882463576, 0.8224398979644773, 0.354576069265434, 0.29908708130424316, 0.7696044836375826, 0.40384881210872364, 0.23715377880587976, 0.25617681906854833, 0.9852668068735764, 0.122330038462891, 0.984574106313678, 0.5003191222799489, 0.5203057818462655, 0.44192929984649637, 0.8820091380108858, 0.2814432850772277, 0.05936774371136846, 0.5846043588115731, 0.3059380655889957, 0.3348636218934457, 0.5577488812870889, 0.2977802285641307, 0.35205995786188576, 0.14705260747785867, 0.3715679328173404, 0.6226111467524794, 0.8129409899104145, 0.9182975870319823, 0.254272477048378, 0.1460367218001266, 0.8037743723992021, 0.8928847686741027, 0.2760807586478134, 0.15802301684559314, 0.8339823615806925, 0.5679436199934321, 0.4702757691698166, 0.49822737699505587, 0.21161282714562085, 0.5336492608607412, 0.6070323677995522, 0.35311399698212553, 0.33763170198834286, 0.8404959871616875, 0.6038461721286814, 0.22819722357235225, 0.749140772126106, 0.982829042738046, 0.36350726396187966, 0.5515050933578035, 0.6658343038438272, 0.35259412166582804, 0.17017618993296968], [0.4513815241838175, 0.7975472286849764, 0.6666972387852672, 0.7582744781107222, 0.47774696299430397, 0.2757780253335644, 0.661900549639593, 0.7137502521060125, 0.48765261329520154, 0.5046182041328285, 0.6076665985369589, 0.4624056399842153, 0.7823324588073151, 0.7474845140597063, 0.43814033038948463, 0.5505931348565849, 0.8476151289145181, 0.41747495386891253, 0.8561009747444143, 0.7776138574567799, 0.40208392783085417, 0.3002977334838275, 0.7791221397710092, 0.14431255214640676, 0.16515735645688992, 0.5838369129561406, 0.0841733647690294, 0.17622073071226171, 0.6138120813925315, 0.6707898769094619, 0.16970648238120037, 0.7196387444133119, 0.47696058740842895, 0.19259839824012756, 0.7323226598922544, 0.8041336469831567, 0.5735309057714812, 0.2661924981709955, 0.3120363211261656, 0.4704303360562226, 0.6010540850017118, 0.35368346529626277, 0.7399745262101479, 0.9111402852519855, 0.6445479245162287, 0.8148445361279185, 0.5825616747688495, 0.6209807439467471, 0.02408919464106233, 0.4306554518535454, 0.8183606127627864, 0.9593230374930339, 0.5695931122121739, 0.04361325543035931, 0.10522031943879327, 0.515314127147757, 0.9029379198313816, 0.9127875509493557, 0.09027272388081244, 0.3785688204161897, 0.8228341941693497, 0.6943810472028764, 0.9861833008000154, 0.5959803056702441], [0.1160748674196578, 0.2277283959760416, 0.9587360688826244, 0.6731962321377438, 0.18128984889853078, 0.704252940202484, 0.8058550847678847, 0.6873008557797976, 0.654934002316442, 0.4755998755658836, 0.8667398574138051, 0.6598973195006557, 0.7393698700699828, 0.6014680784799407, 0.7564081784993878, 0.35342704597754887, 0.9190357636582771, 0.586499685865273, 0.8166891444209143, 0.29819912480142696, 0.24036830582707586, 0.8576026939191979, 0.4015681462225604, 0.5459924746844109, 0.7918598156583309, 0.6930364611822222, 0.9113362204998602, 0.5709945002109506, 0.7491235263329397, 0.866209465657134, 0.030680557226498616, 0.744337990698646, 0.36623113713287786, 0.5846103241752751, 0.1732871310392246, 0.23383644881503443, 0.9185728094571042, 0.7811790991571801, 0.5116767037961661, 0.6713879304077622, 0.8064757790949174, 0.3778979438081452, 0.11297860279845494, 0.5778132704234595, 0.3035839196388137, 0.984191785213561, 0.10404533855169071, 0.5160450343247189, 0.27857000253133796, 0.5375081907337536, 0.9515990627628512, 0.029302250030342175, 0.107890168027556, 0.06219899253914853, 0.6610199263016283, 0.6167540554649106, 0.24773269098001435, 0.4118665056621336, 0.6447423768802925, 0.55080339384534, 0.16461706470739332, 0.6991409852899866, 0.25230907663336544, 0.5014898332258221], [0.9812317790579093, 0.7647149421389609, 0.04354082021743147, 0.6215107481441834, 0.6768899085796516, 0.592058100415143, 0.3685216376227203, 0.166022023029076, 0.8734654676493866, 0.5856069873699418, 0.3903653285232772, 0.5918036278380536, 0.6068353659246151, 0.6702828036236633, 0.8170358234828258, 0.7671988657314006, 0.13096269256004786, 0.12955272885438224, 0.222377549635997, 0.7919001925315472, 0.9783299870028869, 0.8320159207972849, 0.09440334004447162, 0.21385992439099458, 0.9225848866127081, 0.314778654364674, 0.06189658994552539, 0.13619254027284783, 0.0935568371817569, 0.48607931334173904, 0.7625910827243124, 0.865455639318682, 0.6877658449330036, 0.6892447599318046, 0.2866770388219236, 0.40347753719106344, 0.7276439358997698, 0.7480642190956034, 0.8330196813915084, 0.18751663763433418, 0.07822936376300894, 0.845039675619586, 0.4113800896090333, 0.3368479170415403, 0.5452080297867753, 0.35320466859783706, 0.2728874825357904, 0.9363924491809145, 0.7471956394507019, 0.7925278801562156, 0.4610840754890222, 0.5304355739875254, 0.4025038682230292, 0.17313706175198051, 0.15034051864844006, 0.26477867018137186, 0.5403494740072113, 0.656631272678169, 0.45941323322825245, 0.46658548247654325, 0.6924615998482718, 0.950958620688901, 0.015533563711984553, 0.019237556377096378], [0.47401488183094875, 0.48088804558384335, 0.9855513542364884, 0.04881056193365253, 0.7791074842737145, 0.5111549588617385, 0.030990050196164316, 0.6808618487769608, 0.565260051804208, 0.6116020048565307, 0.8331788479629203, 0.36130100237217533, 0.9671680821272998, 0.787729325826997, 0.08934946316138266, 0.6297208689892019, 0.4027812169047703, 0.7829370857888152, 0.02902883754981579, 0.09361701663877921, 0.07155294621754767, 0.43863150467998524, 0.11115565773681257, 0.2529987342653002, 0.33825731784160096, 0.31205673825788155, 0.469571251872394, 0.37881189006009447, 0.4257023888837724, 0.7109298370418559, 0.49009286414843306, 0.8751105275407438, 0.6996977958724704, 0.5525181009969443, 0.7765234371849539, 0.6517327208663857, 0.8807194166019459, 0.8227718323799916, 0.42228320433610095, 0.3408159920076892, 0.29946837052774783, 0.5383961417839932, 0.5045263332069928, 0.505155111570724, 0.22658727240269327, 0.7010110292853868, 0.5006240950204003, 0.9359560621389009, 0.7568864079578245, 0.8926386431659131, 0.29475150389804344, 0.1834509871788705, 0.7670883057097293, 0.291228292248781, 0.6158340626620664, 0.24566031974223682, 0.19407645218215214, 0.057304020475266296, 0.7819570740546079, 0.7258497973710869, 0.311570409281061, 0.1903235870005126, 0.3781044137703359, 0.7650042751676668], [0.7204321759934827, 0.99175061847515, 0.59796109386927, 0.2607414734989157, 0.5327632390989364, 0.09640395436389636, 0.0428419238197256, 0.8558409459412475, 0.7326743552888059, 0.850148738490718, 0.6091305149900891, 0.3153659834883679, 0.49659651460495535, 0.19565486340534025, 0.8926792164788265, 0.8330645266829011, 0.5689728101796316, 0.9465701580063396, 0.10840766234449893, 0.7412275681284637, 0.7423909775931837, 0.6278845046469568, 0.9778608754560457, 0.45902214841649697, 0.9838339753770805, 0.9723279785710605, 0.7281980356669402, 0.22266500913747114, 0.7595016691095217, 0.14814171910855053, 0.859229349054737, 0.7069495944942679, 0.6027822623626197, 0.3660105999900384, 0.9575083140533817, 0.5948822624007043, 0.570214612998842, 0.03544591906346688, 0.6894474365097555, 0.3834467146971045, 0.15779019497253147, 0.9167128811209362, 0.970634095551565, 0.15038529004209567, 0.5870340455594245, 0.8235072880311326, 0.7833913770005898, 0.5956848270000485, 0.9374354524557322, 0.7684935912310055, 0.7845135880709595, 0.49842777330612525, 0.7011511064585192, 0.7911636012002831, 0.8245486310284997, 0.10565452989111482, 0.31721963481957205, 0.08792361167855826, 0.07640062588377501, 0.43491404693289726, 0.004165961496800851, 0.3452894161001238, 0.39086930271706, 0.02604237036607105]]

# Biases: (1 x 128) vector - one bias per neuron
b = [0.9793878773049818, 0.37863699200633805, 0.5561806783725012, 0.34063982549941535, 0.27563669104039007, 0.7346307573765509, 0.5437526809574911, 0.16057395279146439, 0.7759762726575127, 0.5931561813120225]

def relu(x):
    return np.maximum(0, x)

def softmax(x):
    """
    Compute softmax values for each set of scores in x.
    x: input array of shape (1, n_classes)
    returns: array of same shape with probabilities
    """
    # Subtract max for numerical stability (prevents overflow)
    exp_x = np.exp(x - np.max(x))
    return exp_x / np.sum(exp_x)

def forward_layer(X, W, b, final_layer=False):
    """
    Compute forward pass through one layer
    Args:
        X: Input (1 x 784)
        W: Weights (128 x 784) 
        b: Biases (1 x 128)
        final_layer: Boolean indicating if this is the final layer
    Returns:
        Output after activation (1 x 128)
    """
    # Convert inputs to numpy arrays if they aren't already
    X = np.array(X)
    W = np.array(W)
    b = np.array(b)
    
    # Reshape X to (1, 784) if it's 1D
    if len(X.shape) == 1:
        X = X.reshape(1, -1)
        
    # Matrix multiply X with transposed W and add bias
    z = np.dot(X, W.T) + b
    
    # Apply softmax for final layer, ReLU otherwise
    if final_layer:
        return softmax(z)
    return relu(z)

# Run forward pass
output = forward_layer(X, W, b)
print(f"Output shape: {output.shape}")

print("\nOutput values:")
print(output)

# Verify by computing first neuron manually
manual_neuron = sigmoid(np.dot(X, W[0]) + b[0])
print(f"\nFirst neuron (manual calculation): {manual_neuron}")